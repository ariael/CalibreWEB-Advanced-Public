{% extends "layout.html" %}
{% block body %}
<div class="discover">
  <h1>{{title}}</h1>
  <form role="form" method="POST" autocomplete="off">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="col-md-10 col-lg-8">
      {% if new_user or ( current_user and content.name != "Guest" and current_user.role_admin() ) %}
      <div class="form-group required">
        <label for="name">{{_('Username')}}</label>
        <input type="text" class="form-control" name="name" id="name" value="{{ content.name if content.name != None }}"
          autocomplete="off">
      </div>
      {% endif %}
      <div class="form-group">
        <label for="email">{{_('Email')}}</label>
        <input type="email" class="form-control" name="email" id="email"
          value="{{ content.email if content.email != None }}" autocomplete="off">
      </div>
      {% if ( current_user and current_user.role_passwd() or current_user.role_admin() ) and not
      content.role_anonymous() %}
      {% if current_user and current_user.role_admin() and not new_user and not profile and ( mail_configured and
      content.email if content.email != None ) %}
      <a class="btn btn-default postAction" id="resend_password" role="button"
        data-action="{{url_for('admin.reset_user_password', user_id = content.id) }}">{{_('Reset user Password')}}</a>
      {% endif %}
      <div class="form-group">
        <label for="password">{{_('Password')}}</label>
        <input type="password" class="form-control" name="password" id="password" data-lang="{{ current_user.locale }}"
          data-verify="{{ config.config_password_policy }}" {% if config.config_password_policy %} data-min={{
          config.config_password_min_length }} data-word={{ config.config_password_character }} data-special={{
          config.config_password_special }} data-upper={{ config.config_password_upper }} data-lower={{
          config.config_password_lower }} data-number={{ config.config_password_number }}{% endif %} value=""
          autocomplete="off">
      </div>
      {% endif %}
      <div class="form-group">
        <label for="kindle_mail">{{_('Send to eReader Email Address. Use comma to separate emails for multiple
          eReaders')}}</label>
        <input type="email" class="form-control" name="kindle_mail" id="kindle_mail"
          value="{{ content.kindle_mail if content.kindle_mail != None }}">
      </div>
      {% if not content.role_anonymous() %}
      <div class="form-group">
        <label for="locale">{{_('Language')}}</label>
        <select name="locale" id="locale" class="form-control">
          {% for translation in translations %}
          <option value="{{translation}}" {% if translation|string==content.locale %}selected{% endif %}>{{
            translation.display_name|capitalize }}</option>
          {% endfor %}
        </select>
      </div>
      {% endif %}
      <div class="form-group">
        <label for="theme">{{_('Vzhled (Theme)')}}</label>
        <select name="theme" id="theme" class="form-control">
          <optgroup label="Dark Themes">
            <option value="ca_black" {% if content.get_view_property('user', 'theme' )=='ca_black' or not
              content.get_view_property('user', 'theme' ) %}selected{% endif %}>Dark - CA Black (Default)</option>
            <option value="blackboard" {% if content.get_view_property('user', 'theme' )=='blackboard' %}selected{%
              endif %}>Dark - Blackboard</option>
            <option value="cali_dark_blue" {% if content.get_view_property('user', 'theme' )=='cali_dark_blue'
              %}selected{% endif %}>Dark - Midnight Blue</option>
            <option value="cali_dark_forest" {% if content.get_view_property('user', 'theme' )=='cali_dark_forest'
              %}selected{% endif %}>Dark - Forest</option>
            <option value="cali_dark_slate" {% if content.get_view_property('user', 'theme' )=='cali_dark_slate'
              %}selected{% endif %}>Dark - Slate</option>
            <option value="cali_dark_terminal" {% if content.get_view_property('user', 'theme' )=='cali_dark_terminal'
              %}selected{% endif %}>Dark - Retro Terminal</option>
            <option value="cali_nord" {% if content.get_view_property('user', 'theme' )=='cali_nord' %}selected{% endif
              %}>Dark - Nord (Kavita)</option>
            <option value="cali_plex" {% if content.get_view_property('user', 'theme' )=='cali_plex' %}selected{% endif
              %}>Dark - Plex (Kavita)</option>
          </optgroup>
          <optgroup label="Medium Themes">
            <option value="cali_medium_sepia" {% if content.get_view_property('user', 'theme' )=='cali_medium_sepia'
              %}selected{% endif %}>Medium - Sepia</option>
          </optgroup>
          <optgroup label="Light Themes">
            <option value="cali_light_grey" {% if content.get_view_property('user', 'theme' )=='cali_light_grey'
              %}selected{% endif %}>Light - Standard Grey</option>
            <option value="cali_light_solar" {% if content.get_view_property('user', 'theme' )=='cali_light_solar'
              %}selected{% endif %}>Light - Solarized</option>
          </optgroup>
        </select>
      </div>

      <div class="form-group">
        <label for="default_language">{{_('Language of Books')}}</label>
        <select name="default_language" id="default_language" class="form-control">
          <option value="all" {% if content.default_language=="all" %}selected{% endif %}>{{ _('Show All') }}</option>
          {% for language in languages %}
          <option value="{{ language.lang_code }}" {% if content.default_language==language.lang_code %}selected{% endif
            %}>{{ language.name }}</option>
          {% endfor %}
        </select>
      </div>
      {% if registered_oauth.keys()| length > 0 and not new_user and profile %}
      {% for id, name in registered_oauth.items() %}
      <div class="form-group">
        <label>{{ name }} {{_('OAuth Settings')}}</label>
        {% if id not in oauth_status %}
        <a href="{{ url_for('oauth.'+ name +'_login') }}" id="config_{{ id }}_oauth"
          class="btn btn-primary">{{_('Link')}}</a>
        {% else %}
        <a href="{{ url_for('oauth.'+ name +'_login_unlink') }}" id="config_{{ id }}_oauth"
          class="btn btn-primary">{{_('Unlink')}}</a>
        {% endif %}
        {% endfor %}
      </div>
      {% endif %}
      {% if kobo_support and not new_user %}
      <label>{{ _('Kobo Sync Token')}}</label>
      <div class="form-group col">
        <a class="btn btn-default" id="config_create_kobo_token" data-toggle="modal" data-target="#modal_kobo_token"
          data-remote="false"
          href="{{ url_for('kobo_auth.generate_auth_token', user_id=content.id) }}">{{_('Create/View')}}</a>
        <div class="btn btn-danger" id="config_delete_kobo_token" data-value="{{ content.id }}" data-remote="false" {%
          if not content.remote_auth_token.first() %} style="display: none;" {% endif %}>{{_('Delete')}}</div>
      </div>
      <div class="form-group col">
        <div class="btn btn-default" id="kobo_full_sync"
          data-value="{% if current_user.role_admin() %}{{ content.id }}{% else %}0{% endif %}" {% if not
          content.remote_auth_token.first() %} style="display: none;" {% endif %}>{{_('Force full kobo sync')}}</div>
      </div>
      {% endif %}


      {% if not new_user %}
      <div class="form-group">
        <label for="webhook_url">{{_('Social Sync Webhook URL')}}</label>
        <div class="input-group">
          <span class="input-group-addon">
            <input type="checkbox" name="webhook_enabled" id="webhook_enabled" aria-label="Enable Webhook" {% if
              content.webhook_enabled %}checked{% endif %}>
          </span>
          <input type="text" class="form-control" name="webhook_url" id="webhook_url"
            value="{{ content.webhook_url if content.webhook_url != None }}"
            placeholder="https://discord.com/api/webhooks/...">
        </div>
        <small class="form-text text-muted">{{_('Webhook will be triggered when a book reading status changes (e.g.
          Finished).')}}</small>
      </div>

      <div class="form-group">
        <label for="mobile_sync_path">{{_('Cloud Sync Path (Auto-sync Reader Apps)')}}</label>
        <input type="text" class="form-control" name="mobile_sync_path" id="mobile_sync_path"
          value="{{ content.mobile_sync_path if content.mobile_sync_path != None }}"
          placeholder="/mnt/gdrive/Librera/Sync">
        <small class="form-text text-muted">{{_('Automated background sync for Librera, Moon+ Reader, and ReadEra. Set
          path to your cloud-synced folder.')}}</small>
      </div>
      {% endif %}


      <label>{{ _('Librera Reader Sync')}}</label>
      <div class="form-group col">
        <a class="btn btn-default" data-toggle="modal" data-target="#modal_librera_sync" href="#">{{_('Upload
          Progress')}}</a>
      </div>

      <div class="col-sm-6">
        {% for element in sidebar %}
        {% if element['config_show'] %}
        <div class="form-group">
          <input type="checkbox" name="show_{{element['visibility']}}" id="show_{{element['visibility']}}" {% if
            content.check_visibility(element['visibility']) %}checked{% endif %}>
          <label for="show_{{element['visibility']}}">{{element['show_text']}}</label>
        </div>
        {% endif %}
        {% endfor %}
        <div class="form-group">
          <input type="checkbox" name="Show_detail_random" id="Show_detail_random" {% if content.show_detail_random()
            %}checked{% endif %}>
          <label for="Show_detail_random">{{_('Show Random Books in Detail View')}}</label>
        </div>
        {% if ( current_user and current_user.role_admin() and not new_user ) and not simple %}
        <a href="#" id="get_user_tags" class="btn btn-default" data-id="{{content.id}}" data-toggle="modal"
          data-target="#restrictModal">{{_('Add Allowed/Denied Tags')}}</a>
        <a href="#" id="get_user_column_values" data-id="{{content.id}}" class="btn btn-default" data-toggle="modal"
          data-target="#restrictModal">{{_('Add allowed/Denied Custom Column Values')}}</a>
        {% endif %}
      </div>
      <div class="col-sm-6">
        {% if current_user and (current_user.role_admin() or current_user.role_limited_admin()) and not profile %}
        {% if not content.role_anonymous() %}
        {% if current_user.role_admin() %}
        <div class="form-group">
          <input type="checkbox" name="admin_role" id="admin_role" {% if content.role_admin() %}checked{% endif %}>
          <label for="admin_role">{{_('Admin User')}}</label>
        </div>
        <div class="form-group">
          <input type="checkbox" name="limited_admin_role" id="limited_admin_role" {% if content.role_limited_admin()
            %}checked{% endif %}>
          <label for="limited_admin_role">{{_('Limited Admin')}}</label>
        </div>
        {% endif %}
        {% endif %}
        <div class="form-group">
          <input type="checkbox" name="download_role" id="download_role" {% if content.role_download() %}checked{% endif
            %}>
          <label for="download_role">{{_('Allow Downloads')}}</label>
        </div>
        <div class="form-group">
          <input type="checkbox" name="viewer_role" id="viewer_role" {% if content.role_viewer() %}checked{% endif %}>
          <label for="viewer_role">{{_('Allow eBook Viewer')}}</label>
        </div>
        {% if config.config_uploading %}
        <div class="form-group">
          <input type="checkbox" name="upload_role" id="upload_role" {% if content.role_upload() %}checked{% endif %}>
          <label for="upload_role">{{_('Allow Uploads')}}</label>
        </div>
        {% endif %}
        <div class="form-group">
          <input type="checkbox" name="edit_role" data-control="edit_settings" id="edit_role" {% if content.role_edit()
            %}checked{% endif %}>
          <label for="edit_role">{{_('Allow Edit')}}</label>
        </div>
        <div data-related="edit_settings">
          <div class="form-group">
            <input type="checkbox" name="delete_role" id="delete_role" {% if content.role_delete_books() %}checked{%
              endif %}>
            <label for="delete_role">{{_('Allow Delete Books')}}</label>
          </div>
        </div>
        {% if not content.role_anonymous() %}
        <div class="form-group">
          <input type="checkbox" name="passwd_role" id="passwd_role" {% if content.role_passwd() %}checked{% endif %}>
          <label for="passwd_role">{{_('Allow Changing Password')}}</label>
        </div>
        <div class="form-group">
          <input type="checkbox" name="edit_shelf_role" id="edit_shelf_role" {% if content.role_edit_shelfs()
            %}checked{% endif %}>
          <label for="edit_shelf_role">{{_('Allow Editing Public Shelves')}}</label>
        </div>
        {% endif %}
        {% endif %}
        {% if kobo_support and not content.role_anonymous() and not simple%}
        <div class="form-group">
          <input type="checkbox" name="kobo_only_shelves_sync" id="kobo_only_shelves_sync" {% if
            content.kobo_only_shelves_sync %}checked{% endif %}>
          <label for="kobo_only_shelves_sync">{{_('Sync only books in selected shelves with Kobo')}}</label>
        </div>
        {% endif %}
      </div>
      <div class="col-sm-12">
        <div id="user_submit" class="btn btn-default">{{_('Save')}}</div>
        {% if not profile %}
        <div class="btn btn-default" data-back="{{ url_for('admin.admin') }}" id="back">{{_('Cancel')}}</div>
        {% endif %}
        {% if current_user and current_user.role_admin() and not profile and not new_user and not
        content.role_anonymous() %}
        <div class="btn btn-danger" id="btndeluser" data-value="{{ content.id }}" data-remote="false">{{_('Delete
          User')}}</div>
        {% endif %}
      </div>
    </div>
  </form>
</div>

<div class="modal fade" id="modal_kobo_token" tabindex="-1" role="dialog" aria-labelledby="kobo_tokenModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="kobo_tokenModalLabel">{{_('Generate Kobo Auth URL')}}</h4>
      </div>
      <div class="modal-body">...</div>
      <div class="modal-footer">
        <button type="button" id="kobo_close" class="btn btn-default" data-dismiss="modal">{{_('Close')}}</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal_librera_sync" tabindex="-1" role="dialog" aria-labelledby="libreraSyncModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="libreraSyncModalLabel">{{_('Mobile Reader Progress Sync')}}</h4>
      </div>
      <form action="{{ url_for('mobile.upload_progress') }}" method="POST" enctype="multipart/form-data">
        <div class="modal-body">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

          <div class="form-group">
            <label for="app_type">{{_('Select Reader App')}}</label>
            <select class="form-control" name="app_type" id="app_type_select">
              <option value="librera">Librera Reader</option>
              <option value="moon">Moon+ Reader</option>
              <option value="readera">ReadEra</option>
            </select>
          </div>

          <div class="text-center" style="margin-bottom: 20px;">
            <p>{{_('If your Android device is connected via USB:')}}</p>
            <button type="submit" formaction="{{ url_for('mobile.sync_usb_progress') }}" class="btn btn-success btn-lg">
              <span class="glyphicon glyphicon-phone"></span> {{_('Sync from USB Device')}}
            </button>
          </div>

          <hr>

          <p>{{_('Or upload manually:')}}</p>

          <a data-toggle="collapse" href="#manualHelp" aria-expanded="False">
            {{_('How to find the file manually?')}} <span class="caret"></span>
          </a>
          <div id="manualHelp" class="collapse alert alert-info" style="margin-top: 5px;">
            <div class="help-librera app-help">
              <strong>{{_('Librera:')}}</strong>
              <code>Internal Storage/Librera/profile.Librera/device.[Name]/app-Progress.json</code><br>
              {{_('Or use Backup > Export to get the zip.')}}
            </div>
            <div class="help-moon app-help" style="display:none;">
              <strong>{{_('Moon+:')}}</strong> <code>/sdcard/Books/MoonReader/.mrpro</code> (Backup File)<br>
              {{_('Use Options > Backup in the app.')}}
            </div>
            <div class="help-readera app-help" style="display:none;">
              <strong>{{_('ReadEra:')}}</strong> <code>.bak</code> file created via <strong>Backup & Restore</strong>
              menu.
            </div>
          </div>

          <div class="form-group" style="margin-top: 10px;">
            <input type="file" name="file" class="form-control">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">{{_('Close')}}</button>
          <button type="submit" class="btn btn-primary">{{_('Upload & Sync')}}</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  document.getElementById('app_type_select').addEventListener('change', function () {
    var val = this.value;
    var helps = document.getElementsByClassName('app-help');
    for (var i = 0; i < helps.length; i++) {
      helps[i].style.display = 'none';
    }
    document.querySelector('.help-' + val).style.display = 'block';
  });
</script>

{% endblock %}
{% block modal %}
{{ restrict_modal() }}
{{ delete_confirm_modal() }}
{% endblock %}
{% block js %}
<script src="{{ url_for('static', filename='js/libs/bootstrap-table/bootstrap-table.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/libs/bootstrap-table/bootstrap-table-editable.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/libs/bootstrap-table/bootstrap-editable.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/libs/pwstrength/i18next.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/libs/pwstrength/i18nextHttpBackend.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/libs/pwstrength/pwstrength-bootstrap.js') }}"></script>
<script src="{{ url_for('static', filename='js/password.js') }}"></script>
<script src="{{ url_for('static', filename='js/table.js') }}"></script>
{% endblock %}